<th:block th:fragment="businessRuleContent">

    <style>
        :root {
            --sidebar-bg: #2c3e50;
            --sidebar-hover: #34495e;
            --primary-color: #3498db;
            --document-bg: #ffffff;
            --border-color: #e9ecef;
            --text-primary: #2c3e50;
            --text-secondary: #6c757d;
        }

        body {
            font-family: 'Times New Roman', serif;
            background-color: #f8f9fa;
            line-height: 1.6;
        }

        .sidebar {
            background-color: var(--sidebar-bg);
            min-height: 100vh;
            width: 280px;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1000;
            transition: all 0.3s;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .sidebar .brand {
            padding: 1.5rem;
            color: white;
            font-size: 1.4rem;
            font-weight: bold;
            border-bottom: 1px solid #34495e;
        }

        .sidebar .brand i {
            color: #e67e22;
            margin-right: 0.5rem;
        }

        .sidebar-nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav li {
            border-bottom: 1px solid #34495e;
        }

        .sidebar-nav a {
            display: block;
            padding: 1rem 1.5rem;
            color: #bdc3c7;
            text-decoration: none;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background-color: var(--sidebar-hover);
            color: white;
        }

        .sidebar-nav i {
            margin-right: 0.75rem;
            width: 20px;
        }

        .main-content {
            padding: 0;
        }

        .top-navbar {
            background-color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .document-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn-document {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
        }

        .btn-save {
            background-color: #27ae60;
            color: white;
        }

        .btn-save:hover {
            background-color: #219a52;
        }

        .btn-export {
            background-color: #3498db;
            color: white;
        }

        .btn-export:hover {
            background-color: #2980b9;
        }

        .btn-add-clause {
            background-color: #e67e22;
            color: white;
        }

        .btn-add-clause:hover {
            background-color: #d35400;
        }

        .document-container {
            max-width: 900px;
            margin: 2rem auto;
            background-color: var(--document-bg);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            min-height: calc(100vh - 4rem);
        }

        .document-header {
            text-align: center;
            padding: 3rem 3rem 2rem;
            border-bottom: 2px solid var(--border-color);
        }

        .document-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .document-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .document-date {
            font-size: 1rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .document-body {
            padding: 2rem 3rem 3rem;
        }

        .preamble {
            margin-bottom: 2.5rem;
            padding: 1.5rem;
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            font-style: italic;
        }

        .clause {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            position: relative;
            transition: all 0.3s;
        }

        .clause:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .clause-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .clause-number {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-right: 1rem;
        }

        .clause-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--text-primary);
            flex-grow: 1;
        }

        .clause-actions {
            display: flex;
            gap: 0.5rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .clause:hover .clause-actions {
            opacity: 1;
        }

        .btn-clause-action {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-edit-clause {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .btn-edit-clause:hover {
            background-color: #1976d2;
            color: white;
        }

        .btn-delete-clause {
            background-color: #ffebee;
            color: #d32f2f;
        }

        .btn-delete-clause:hover {
            background-color: #d32f2f;
            color: white;
        }

        .clause-content {
            font-size: 1rem;
            line-height: 1.8;
            color: var(--text-primary);
            text-align: justify;
        }

        .clause-content p {
            margin-bottom: 1rem;
        }

        .clause-content ul, .clause-content ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        .clause-content li {
            margin-bottom: 0.5rem;
        }

        .clause-metadata {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e9ecef;
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
        }

        .signature-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid var(--border-color);
        }

        .signature-block {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
        }

        .signature-line {
            width: 45%;
            text-align: center;
        }

        .signature-line hr {
            border: none;
            border-top: 1px solid #000;
            margin-bottom: 0.5rem;
        }

        .editable-content {
            border: 2px dashed transparent;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .editable-content:hover {
            border-color: var(--primary-color);
            background-color: #f8f9fa;
        }

        .editable-content.editing {
            border-color: var(--primary-color);
            background-color: white;
        }

        .edit-textarea {
            width: 100%;
            border: none;
            outline: none;
            resize: vertical;
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
            background: transparent;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .document-container {
                margin: 1rem;
            }

            .document-header,
            .document-body {
                padding: 1.5rem;
            }

            .document-title {
                font-size: 2rem;
            }
        }

        /* Modal Styles */
        .modal-header {
            background-color: var(--sidebar-bg);
            color: white;
        }

        .modal-header .btn-close {
            filter: invert(1);
        }

        .form-label {
            font-weight: 600;
            color: #2c3e50;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }

        .status-indicator {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-active {
            background-color: #27ae60;
        }

        .status-pending {
            background-color: #f39c12;
        }

        .status-inactive {
            background-color: #e74c3c;
        }
    </style>
    </head>
    <body>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Navbar -->
        <div class="top-navbar">
            <div class="d-flex align-items-center">
                <button class="btn btn-link d-md-none me-3" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h5 class="mb-0">Business Rules Contract - Version 2.1</h5>
            </div>
            <div class="document-actions">
                <button class="btn-document btn-add-clause" onclick="addNewClause()">
                    <i class="fas fa-plus me-2"></i>Add Clause
                </button>
                <button class="btn-document btn-save" onclick="saveDocument()">
                    <i class="fas fa-save me-2"></i>Save
                </button>
                <button class="btn-document btn-export" onclick="exportDocument()">
                    <i class="fas fa-download me-2"></i>Export
                </button>
            </div>
        </div>

        <!-- Document Container -->
        <div class="document-container">
            <!-- Document Header -->
            <div class="document-header">
                <div class="document-title editable-content" onclick="makeEditable(this)">
                    Business Rules and Regulations Contract
                </div>
                <div class="document-subtitle editable-content" onclick="makeEditable(this)">
                    System Governance and Operational Guidelines
                </div>
                <div class="document-date">
                    Effective Date: <span class="editable-content" onclick="makeEditable(this)">January 15, 2024</span>
                </div>
            </div>

            <!-- Document Body -->
            <div class="document-body">
                <!-- Preamble -->
                <div class="preamble">
                    <div class="editable-content" onclick="makeEditable(this)">
                        This Business Rules Contract establishes the fundamental principles, regulations, and
                        operational guidelines that govern the business processes and decision-making framework within
                        our organization. These rules ensure consistency, compliance, and optimal performance across all
                        business operations.
                    </div>
                </div>

                <!-- Clauses Container -->
                <div id="clausesContainer">
                    <!-- Clauses will be populated by JavaScript -->
                </div>

                <!-- Signature Section -->
                <div class="signature-section">
                    <h4>Approval and Authorization</h4>
                    <p>By signing below, the parties acknowledge that they have read, understood, and agree to be bound
                        by the terms and conditions set forth in this Business Rules Contract.</p>

                    <div class="signature-block">
                        <div class="signature-line">
                            <hr>
                            <strong>Business Manager</strong><br>
                            <small>Date: _______________</small>
                        </div>
                        <div class="signature-line">
                            <hr>
                            <strong>System Administrator</strong><br>
                            <small>Date: _______________</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Clause Modal -->
    <div class="modal fade" id="clauseModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Add New Clause</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="clauseForm">
                        <div class="row g-3">
                            <div class="col-md-8">
                                <label class="form-label">Clause Title *</label>
                                <input type="text" class="form-control" id="clauseTitle" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="clauseStatus">
                                    <option value="active">Active</option>
                                    <option value="pending">Pending</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Clause Content *</label>
                                <textarea class="form-control" id="clauseContent" rows="8" required
                                          placeholder="Enter the detailed content of this business rule clause..."></textarea>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Category</label>
                                <select class="form-select" id="clauseCategory">
                                    <option value="general">General Provisions</option>
                                    <option value="operational">Operational Rules</option>
                                    <option value="financial">Financial Regulations</option>
                                    <option value="compliance">Compliance Requirements</option>
                                    <option value="security">Security Policies</option>
                                    <option value="data">Data Management</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Priority Level</label>
                                <select class="form-select" id="clausePriority">
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                    <option value="critical">Critical</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveClause">Save Clause</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample business rules clauses
        let businessClauses = [
            {
                id: 1,
                title: "User Authentication and Access Control",
                content: `<p><strong>1.1 Authentication Requirements:</strong> All users must authenticate using multi-factor authentication (MFA) before accessing the system. This includes:</p>
                <ul>
                    <li>Primary authentication via username and password</li>
                    <li>Secondary authentication via SMS, email, or authenticator app</li>
                    <li>Biometric verification for high-security areas</li>
                </ul>
                <p><strong>1.2 Access Control:</strong> User access rights shall be determined based on role-based access control (RBAC) principles, ensuring users only have access to resources necessary for their job functions.</p>
                <p><strong>1.3 Session Management:</strong> User sessions must expire after 30 minutes of inactivity, and users must re-authenticate for sensitive operations.</p>`,
                category: "security",
                priority: "critical",
                status: "active",
                lastModified: "2024-01-15"
            },
            {
                id: 2,
                title: "Data Validation and Processing Rules",
                content: `<p><strong>2.1 Input Validation:</strong> All data inputs must be validated according to the following criteria:</p>
                <ol>
                    <li>Data type validation (string, number, date, etc.)</li>
                    <li>Format validation using predefined patterns</li>
                    <li>Range and length validation</li>
                    <li>Business logic validation</li>
                </ol>
                <p><strong>2.2 Data Processing:</strong> Data processing operations must follow these guidelines:</p>
                <ul>
                    <li>All calculations must be performed using appropriate precision</li>
                    <li>Currency values must be rounded to two decimal places</li>
                    <li>Date operations must account for timezone differences</li>
                </ul>
                <p><strong>2.3 Error Handling:</strong> Invalid data must be rejected with clear error messages, and all validation failures must be logged for audit purposes.</p>`,
                category: "operational",
                priority: "high",
                status: "active",
                lastModified: "2024-01-12"
            },
            {
                id: 3,
                title: "Financial Transaction Approval Workflow",
                content: `<p><strong>3.1 Transaction Limits:</strong> Financial transactions are subject to the following approval requirements:</p>
                <ul>
                    <li>Transactions under $1,000: Automatic approval</li>
                    <li>Transactions $1,000 - $10,000: Supervisor approval required</li>
                    <li>Transactions $10,000 - $50,000: Manager approval required</li>
                    <li>Transactions over $50,000: Executive approval required</li>
                </ul>
                <p><strong>3.2 Approval Process:</strong> All approval requests must include transaction details, business justification, and supporting documentation. Approvers have 48 hours to respond to approval requests.</p>
                <p><strong>3.3 Emergency Procedures:</strong> In emergency situations, transactions may be processed with post-approval documentation, subject to executive review within 24 hours.</p>`,
                category: "financial",
                priority: "critical",
                status: "active",
                lastModified: "2024-01-10"
            },
            {
                id: 4,
                title: "Compliance and Audit Requirements",
                content: `<p><strong>4.1 Regulatory Compliance:</strong> All business operations must comply with applicable laws and regulations, including but not limited to:</p>
                <ul>
                    <li>Data protection and privacy regulations (GDPR, CCPA)</li>
                    <li>Financial reporting standards (SOX, GAAP)</li>
                    <li>Industry-specific regulations</li>
                </ul>
                <p><strong>4.2 Audit Trail:</strong> The system must maintain comprehensive audit logs including:</p>
                <ol>
                    <li>User actions and system access</li>
                    <li>Data modifications and deletions</li>
                    <li>System configuration changes</li>
                    <li>Security events and incidents</li>
                </ol>
                <p><strong>4.3 Reporting:</strong> Compliance reports must be generated monthly and reviewed by the compliance team. Any violations must be reported immediately to management.</p>`,
                category: "compliance",
                priority: "critical",
                status: "pending",
                lastModified: "2024-01-08"
            },
            {
                id: 5,
                title: "System Performance and Availability Standards",
                content: `<p><strong>5.1 Performance Requirements:</strong> The system must meet the following performance standards:</p>
                <ul>
                    <li>Response time: 95% of requests must be processed within 2 seconds</li>
                    <li>Throughput: System must handle minimum 1000 concurrent users</li>
                    <li>Database queries must execute within 500ms for standard operations</li>
                </ul>
                <p><strong>5.2 Availability Standards:</strong> System availability must be maintained at 99.9% uptime, with planned maintenance windows scheduled during off-peak hours.</p>
                <p><strong>5.3 Monitoring and Alerting:</strong> Continuous monitoring must be in place with automated alerts for performance degradation, system errors, and security incidents.</p>`,
                category: "operational",
                priority: "high",
                status: "active",
                lastModified: "2024-01-05"
            }
        ];

        let editingClauseId = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function () {
            renderClauses();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Sidebar toggle for mobile
            document.getElementById('sidebarToggle').addEventListener('click', function () {
                document.getElementById('sidebar').classList.toggle('show');
            });

            // Save clause
            document.getElementById('saveClause').addEventListener('click', saveClause);

            // Reset form when modal is hidden
            document.getElementById('clauseModal').addEventListener('hidden.bs.modal', function () {
                resetForm();
            });
        }

        function renderClauses() {
            const container = document.getElementById('clausesContainer');
            container.innerHTML = '';

            businessClauses.forEach((clause, index) => {
                const clauseElement = createClauseElement(clause, index + 1);
                container.appendChild(clauseElement);
            });
        }

        function createClauseElement(clause, number) {
            const article = document.createElement('div');
            article.className = 'clause';
            article.innerHTML = `
                <div class="status-indicator status-${clause.status}"></div>
                <div class="clause-header">
                    <div class="d-flex align-items-center flex-grow-1">
                        <div class="clause-number">Article ${number}</div>
                        <div class="clause-title">${clause.title}</div>
                    </div>
                    <div class="clause-actions">
                        <button class="btn-clause-action btn-edit-clause" onclick="editClause(${clause.id})" title="Edit Clause">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-clause-action btn-delete-clause" onclick="deleteClause(${clause.id})" title="Delete Clause">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="clause-content">
                    ${clause.content}
                </div>
                <div class="clause-metadata">
                    <span><strong>Category:</strong> ${clause.category.charAt(0).toUpperCase() + clause.category.slice(1)}</span>
                    <span><strong>Priority:</strong> ${clause.priority.charAt(0).toUpperCase() + clause.priority.slice(1)}</span>
                    <span><strong>Last Modified:</strong> ${formatDate(clause.lastModified)}</span>
                </div>
            `;
            return article;
        }

        function makeEditable(element) {
            if (element.classList.contains('editing')) return;

            const originalContent = element.innerHTML;
            element.classList.add('editing');

            const textarea = document.createElement('textarea');
            textarea.className = 'edit-textarea';
            textarea.value = element.textContent;
            textarea.style.height = Math.max(element.offsetHeight, 40) + 'px';

            element.innerHTML = '';
            element.appendChild(textarea);
            textarea.focus();
            textarea.select();

            function saveEdit() {
                element.classList.remove('editing');
                element.innerHTML = textarea.value || originalContent;
            }

            function cancelEdit() {
                element.classList.remove('editing');
                element.innerHTML = originalContent;
            }

            textarea.addEventListener('blur', saveEdit);
            textarea.addEventListener('keydown', function (e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    saveEdit();
                } else if (e.key === 'Escape') {
                    cancelEdit();
                }
            });
        }

        function addNewClause() {
            editingClauseId = null;
            document.getElementById('modalTitle').textContent = 'Add New Clause';
            const modal = new bootstrap.Modal(document.getElementById('clauseModal'));
            modal.show();
        }

        function editClause(id) {
            const clause = businessClauses.find(c => c.id === id);
            if (!clause) return;

            editingClauseId = id;

            // Populate form
            document.getElementById('clauseTitle').value = clause.title;
            document.getElementById('clauseContent').value = clause.content.replace(/<[^>]*>/g, ''); // Strip HTML for editing
            document.getElementById('clauseCategory').value = clause.category;
            document.getElementById('clausePriority').value = clause.priority;
            document.getElementById('clauseStatus').value = clause.status;

            // Update modal title
            document.getElementById('modalTitle').textContent = 'Edit Clause';

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('clauseModal'));
            modal.show();
        }

        function deleteClause(id) {
            if (confirm('Are you sure you want to delete this clause? This action cannot be undone.')) {
                businessClauses = businessClauses.filter(c => c.id !== id);
                renderClauses();
            }
        }

        function saveClause() {
            const form = document.getElementById('clauseForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const content = document.getElementById('clauseContent').value;
            const formattedContent = formatClauseContent(content);

            const clauseData = {
                title: document.getElementById('clauseTitle').value,
                content: formattedContent,
                category: document.getElementById('clauseCategory').value,
                priority: document.getElementById('clausePriority').value,
                status: document.getElementById('clauseStatus').value,
                lastModified: new Date().toISOString().split('T')[0]
            };

            if (editingClauseId) {
                // Update existing clause
                const clauseIndex = businessClauses.findIndex(c => c.id === editingClauseId);
                if (clauseIndex !== -1) {
                    businessClauses[clauseIndex] = {...businessClauses[clauseIndex], ...clauseData};
                }
            } else {
                // Add new clause
                const newClause = {
                    id: Math.max(...businessClauses.map(c => c.id)) + 1,
                    ...clauseData
                };
                businessClauses.push(newClause);
            }

            renderClauses();

            // Hide modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('clauseModal'));
            modal.hide();
        }

        function formatClauseContent(content) {
            // Simple formatting: convert line breaks to paragraphs
            return content.split('\n\n').map(paragraph =>
                paragraph.trim() ? `<p>${paragraph.trim()}</p>` : ''
            ).join('');
        }

        function resetForm() {
            document.getElementById('clauseForm').reset();
            document.getElementById('modalTitle').textContent = 'Add New Clause';
            editingClauseId = null;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function saveDocument() {
            alert('Document saved successfully!');
        }

        function exportDocument() {
            const exportOptions = [
                'Export as PDF',
                'Export as Word Document',
                'Export as HTML',
                'Export as Plain Text'
            ];

            const choice = prompt('Choose export format:\n' + exportOptions.map((opt, i) => `${i + 1}. ${opt}`).join('\n'));

            if (choice && choice >= 1 && choice <= 4) {
                alert(`Exporting document as ${exportOptions[choice - 1]}...`);
            }
        }
    </script>
    </body>
</th:block>