<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<div th:replace="~{homePage/fragments/header :: header}"></div>

<body>
	<!-- Header START -->
	<div th:replace="~{homePage/fragments/navHeader :: navHeader}"></div>
	<!-- Header END -->

	<!-- **************** MAIN CONTENT START **************** -->

	<div th:replace="~{__${fragmentContent}__}"></div>
	<!-- **************** MAIN CONTENT END **************** -->

	<!-- =======================
Footer START -->
	<div th:replace="~{homePage/fragments/footer :: footer}"></div>
	<!-- =======================
Footer END -->

	<!-- Back to top -->
	<div class="back-top"><i class="bi bi-arrow-up-short position-absolute top-50 start-50 translate-middle"></i></div>

	<!-- jQuery LU√îN ƒê·ªÇ TR∆Ø·ªöC c√°c file kh√°c -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<!-- Bootstrap JS -->
	<script th:src="@{/assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>

	<!-- C√°c vendor kh√°c -->
	<script th:src="@{/assets/vendor/tiny-slider/tiny-slider.js}"></script>
	<script th:src="@{/assets/vendor/glightbox/js/glightbox.js}"></script>
	<script th:src="@{/assets/vendor/purecounterjs/dist/purecounter_vanilla.js}"></script>

	<!-- Template Functions -->
	<script th:src="@{/assets/js/functions.js}"></script>
	<script th:src="@{/js/homePage/wishlist.js}"></script>
	<script th:src="@{/js/homePage/addtocart.js}"></script>

	<script>
		function toggleMoreCategories(event) {
			event.preventDefault();
			document.querySelectorAll("#moreCategories").forEach(el => el.style.display = "block");
			event.target.style.display = "none";
		}
		$(document).ready(function () {
			function loadCoursesByCategory(categoryId) {
				console.log('Loading courses for Category ID:', categoryId);

				$.ajax({
					url: 'fragments/courseByCategory',
					type: 'GET',
					data: {
						'categoryId': categoryId
					},
					success: function (data) {
						$('#course-pills-tabContent').html(data);
						// Trigger custom event to update wishlist status
						document.dispatchEvent(new CustomEvent('courses-loaded'));
					},
					error: function () {
						console.error('L·ªói khi t·∫£i d·ªØ li·ªáu');
					}
				});
			}

			// B·∫Øt s·ª± ki·ªán click v√†o c√°c tab
			$('#course-pills-tab .nav-link').on('click', function (e) {
				e.preventDefault();

				$('#course-pills-tab .nav-link').removeClass('active');
				$(this).addClass('active');

				const categoryId = $(this).data('category-id');
				loadCoursesByCategory(categoryId);
			});

			// üî• Khi v·ª´a load trang, g·ªçi lu√¥n AJAX cho tab ƒë·∫ßu ti√™n (tab m·∫∑c ƒë·ªãnh active)
			const firstActiveTab = $('#course-pills-tab .nav-link.active');
			if (firstActiveTab.length > 0) {
				const defaultCategoryId = firstActiveTab.data('category-id');
				loadCoursesByCategory(defaultCategoryId);
			}
		});

		$(document).ready(function () {
			// Khi b·∫•m Profile tr√™n dropdown
			$('#dropdown-profile-btn').on('click', function (e) {
				e.preventDefault();
				$.get('/user/profile/fragment', function (data) {
					$('#profile-container').html(data);
					// G·∫Øn l·∫°i s·ª± ki·ªán cho n√∫t Edit Profile trong fragment
					$('#btn-edit-profile').on('click', function () {
						$.get('/user/profile/edit-fragment', function (data) {
							$('#profile-container').html(data);
							// G·∫Øn l·∫°i s·ª± ki·ªán cho n√∫t Cancel trong form edit
							$('#btn-cancel-edit').on('click', function () {
								$('#dropdown-profile-btn').click();
							});
						});
					});
				});
			});
		});
	</script>

</body>

</html>