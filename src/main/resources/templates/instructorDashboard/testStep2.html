<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Course Step 2</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        .chapter-card { border: 1px solid #dee2e6; border-radius: 0.5rem; margin-bottom: 1.5rem; background: #fff; }
        .chapter-header { padding: 1rem; background: #f8f9fa; border-bottom: 1px solid #dee2e6; }
        .chapter-body { padding: 1rem; }
        .drag-handle { cursor: move; color: #adb5bd; }
        .lesson-count-badge { font-size: 0.75rem; }
    </style>
</head>
<body>
<div class="container py-4">
    <h3 class="mb-4">Chapters & Lessons</h3>
    <div id="emptyState" class="empty-state text-center py-5">
        <button class="btn btn-primary" onclick="addChapter()">
            <i class="bi bi-plus"></i> Add Chapter
        </button>
    </div>
    <div id="chaptersContainer"></div>
</div>

<script>
    let chapterCounter = 0;
    let totalChapters = 0;

    document.addEventListener('DOMContentLoaded', function () {
        updateStats();
    });

    function addChapter() {
        chapterCounter++;
        totalChapters++;

        // Hide empty state if it's visible
        const emptyState = document.getElementById('emptyState');
        if (emptyState) emptyState.style.display = 'none';

        const container = document.getElementById('chaptersContainer');
        const chapterId = `chapter-${chapterCounter}`;

        const chapterDiv = document.createElement('div');
        chapterDiv.className = 'chapter-card';
        chapterDiv.id = chapterId;
        chapterDiv.innerHTML = `
            <div class="chapter-header">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-grip-vertical drag-handle me-2"></i>
                            <div class="flex-grow-1">
                                <input type="text" class="form-control" placeholder="Chapter Title"
                                    value="Chapter ${chapterCounter}" onchange="updateChapterTitle(this, '${chapterId}')">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex justify-content-end chapter-actions">
                            <span class="badge bg-secondary lesson-count-badge me-2">0 lessons</span>
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="addLesson('${chapterId}')">
                                <i class="bi bi-plus"></i> Add Lesson
                            </button>
                            <button class="btn btn-sm btn-outline-secondary me-2" onclick="collapseChapter('${chapterId}')">
                                <i class="bi bi-chevron-up"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="removeChapter('${chapterId}')">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="chapter-body" id="${chapterId}-body">
                <div class="lessons-container" id="${chapterId}-lessons">
                    <div class="text-center text-muted py-3">
                        <i class="bi bi-camera-video mb-2" style="font-size: 1.5rem;"></i>
                        <p>No lessons yet. Add your first lesson.</p>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <button class="btn btn-outline-primary btn-sm" onclick="addLesson('${chapterId}')">
                        <i class="bi bi-plus me-1"></i> Add Lesson
                    </button>
                </div>
            </div>
        `;

        container.appendChild(chapterDiv);

        // Always show "Add Chapter" button below the last chapter
        updateAddChapterButton();
    }

    function updateAddChapterButton() {
        // Remove any existing add chapter button
        let btn = document.getElementById('addChapterBtnLast');
        if (btn) btn.remove();

        // Add new button after last chapter
        const container = document.getElementById('chaptersContainer');
        if (container.children.length > 0) {
            const addBtn = document.createElement('div');
            addBtn.className = 'text-center mb-4';
            addBtn.innerHTML = `<button id="addChapterBtnLast" class="btn btn-primary" onclick="addChapter()">
                <i class="bi bi-plus"></i> Add Chapter
            </button>`;
            container.appendChild(addBtn);
        }
    }

    function addLesson(chapterId) {
        const lessonsContainer = document.getElementById(`${chapterId}-lessons`);
        const lessonCount = lessonsContainer.querySelectorAll('.lesson-item').length + 1;
        // Remove empty state if present
        const empty = lessonsContainer.querySelector('.text-muted');
        if (empty) empty.remove();

        const lessonDiv = document.createElement('div');
        lessonDiv.className = 'lesson-item mb-2';
        lessonDiv.innerHTML = `
            <div class="d-flex align-items-center">
                <span class="me-2"><i class="bi bi-play-circle"></i></span>
                <input type="text" class="form-control me-2" value="Lesson ${lessonCount}">
                <button class="btn btn-sm btn-outline-danger" onclick="this.parentElement.parentElement.remove()">Remove</button>
            </div>
        `;
        lessonsContainer.appendChild(lessonDiv);

        // Update lesson count badge
        const badge = document.querySelector(`#${chapterId} .lesson-count-badge`);
        badge.textContent = `${lessonCount} lessons`;
    }

    function removeChapter(chapterId) {
        document.getElementById(chapterId).remove();
        totalChapters--;
        if (totalChapters === 0) {
            document.getElementById('emptyState').style.display = 'block';
        }
        updateAddChapterButton();
    }

    function updateChapterTitle(input, chapterId) {
        // Optionally update preview or stats
    }

    function collapseChapter(chapterId) {
        const body = document.getElementById(`${chapterId}-body`);
        if (body.style.display === 'none') {
            body.style.display = '';
        } else {
            body.style.display = 'none';
        }
    }

    function updateStats() {
        // Optionally update stats
    }
</script>
</body>
</html>