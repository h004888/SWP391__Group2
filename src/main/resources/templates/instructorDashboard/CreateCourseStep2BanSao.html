<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div class="main-content" th:fragment="step2Content">
  <div class="container-fluid py-4">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="h3 mb-0">Create New Course</h1>
        <p class="text-muted">Fill in the details below to create your course</p>
      </div>
    </div>

    <div class="content-card">
      <div class="step-indicator">
        <div class="step completed" data-step="1">
          <div class="step-circle">1</div>
          <div class="step-label">Basic Info</div>
        </div>
        <div class="step active" data-step="2">
          <div class="step-circle">2</div>
          <div class="step-label">Course Content</div>
        </div>
        <div class="step" data-step="3">
          <div class="step-circle">3</div>
          <div class="step-label">Pricing & Settings</div>
        </div>
        <div class="step" data-step="4">
          <div class="step-circle">4</div>
          <div class="step-label">Preview & Publish</div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">
        <div class="container form-container">
          <h3 class="form-title">Course Structure</h3>

          <!-- Add Chapter Form -->
          <div class="chapter-form-section mb-4">
            <h5 class="mb-3">Add New Chapter</h5>
            <form th:action="@{/instructordashboard/viewcourse/chaptersadd}" th:object="${chapter}" method="post" class="mb-4">
              <div class="row">
                <div class="col-md-6">
                  <label class="form-label">Chapter Title*</label>
                  <input type="text" th:field="*{title}" class="form-control" required>
                  <input type="hidden" name="courseId" th:value="${chapter.courseId}">
                </div>
                <div class="col-md-6">
                  <label class="form-label">Chapter Description*</label>
                  <textarea class="form-control" th:field="*{description}" rows="2"></textarea>
                </div>
              </div>
              <button type="submit" class="btn btn-custom mt-3">
                <i class="bi bi-plus-circle me-1"></i> Add Chapter
              </button>
            </form>
          </div>

          <!-- Chapters List -->
          <div th:if="${!#lists.isEmpty(chapters)}" class="chapters-section">
            <h5 class="mb-3">Course Chapters</h5>
            <div th:each="chapter, chapterStat : ${chapters}" class="chapter-container mb-4">
              <div class="chapter-card">
                <div class="chapter-header">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h4 class="mb-1" th:text="${'Chapter ' + (chapterStat.index + 1) + ': ' + chapter.title}">Chapter Title</h4>
                      <p class="text-muted mb-0" th:text="${chapter.description}">Chapter Description</p>
                    </div>
                    <div class="chapter-actions">
                      <button class="btn btn-sm btn-outline-primary" type="button"
                              th:attr="data-chapterid=${chapter.id}"
                              onclick="showLessonForm(this)">
                        <i class="bi bi-plus me-1"></i> Add Lesson
                      </button>
                      <button class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>

                <div class="chapter-body">
                  <!-- Lessons List -->
                  <div th:if="${chapter.lessons != null and !#lists.isEmpty(chapter.lessons)}" class="lessons-section">
                    <div th:each="lesson, lessonStat : ${chapter.lessons}" class="lesson-item mb-3">
                      <div class="lesson-header d-flex justify-content-between align-items-center mb-2">
                        <div>
                          <h6 class="mb-1" th:text="${'Lesson ' + (lessonStat.index + 1) + ': ' + lesson.title}">Lesson Title</h6>
                          <p class="text-muted small mb-0" th:text="${lesson.description}">Lesson Description</p>
                        </div>
                        <div class="lesson-actions">
                          <span class="badge bg-secondary me-2" th:if="${lesson.isFree}">Free</span>
                          <span class="badge bg-primary me-2" th:unless="${lesson.isFree}">Premium</span>
                          <button class="btn btn-sm btn-outline-primary" type="button"
                                  th:attr="data-lessonid=${lesson.id}"
                                  onclick="showQuizForm(this)">
                            <i class="bi bi-plus me-1"></i> Add Quiz
                          </button>
                        </div>
                      </div>

                      <!-- Video Section -->
                      <div class="lesson-content">
                        <div class="video-section mb-3" th:if="${lesson.video != null}">
                          <div class="d-flex align-items-center">
                            <i class="bi bi-play-circle-fill text-primary me-2"></i>
                            <span class="fw-medium">Video:</span>
                            <a href="#" th:text="${lesson.video.title ?: 'Video Content'}"
                               th:attr="data-videoid=${lesson.video.videoUrl}"
                               class="lesson-video-link ms-2">Video Content</a>
                            <span class="text-muted ms-2" th:text="${'(' + lesson.duration + ')'}"></span>
                          </div>
                        </div>

                        <!-- Add Video Form (if no video exists) -->
                        <div th:unless="${lesson.video != null}" class="add-video-section mb-3">
                          <button class="btn btn-sm btn-outline-success" type="button"
                                  th:attr="data-lessonid=${lesson.id}"
                                  onclick="showVideoForm(this)">
                            <i class="bi bi-camera-video me-1"></i> Add Video
                          </button>
                        </div>

                        <!-- Quizzes Section -->
                        <div class="quizzes-section" th:if="${lesson.quizzes != null and !#lists.isEmpty(lesson.quizzes)}">
                          <div class="quiz-list">
                            <div th:each="quiz, quizStat : ${lesson.quizzes}" class="quiz-item d-flex align-items-center mb-2">
                              <i class="bi bi-question-circle-fill text-warning me-2"></i>
                              <span class="fw-medium">Quiz:</span>
                              <span th:text="${quiz.question}" class="ms-2">Quiz Question</span>
                              <button class="btn btn-sm btn-outline-secondary ms-auto">
                                <i class="bi bi-pencil"></i>
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Add Video Form -->
                      <form th:action="@{/instructordashboard/viewcourse/videoadd}" method="post"
                            class="video-form mt-3" style="display:none;"
                            th:attr="data-lessonid=${lesson.id}">
                        <input type="hidden" name="lessonId" th:value="${lesson.id}">
                        <div class="row">
                          <div class="col-md-8">
                            <label class="form-label">Video URL*</label>
                            <input type="text" name="videoUrl" class="form-control" placeholder="YouTube video URL" required>
                          </div>
                          <div class="col-md-4">
                            <label class="form-label">Duration*</label>
                            <input type="text" name="duration" class="form-control" placeholder="e.g., 10:30" required>
                          </div>
                        </div>
                        <div class="mt-2">
                          <button type="submit" class="btn btn-success btn-sm">Save Video</button>
                          <button type="button" class="btn btn-secondary btn-sm" onclick="hideVideoForm(this)">Cancel</button>
                        </div>
                      </form>

                      <!-- Add Quiz Form -->
                      <form th:action="@{/instructordashboard/viewcourse/quizadd}" method="post"
                            class="quiz-form mt-3" style="display:none;"
                            th:attr="data-lessonid=${lesson.id}">
                        <input type="hidden" name="lessonId" th:value="${lesson.id}">
                        <div class="quiz-form-content">
                          <div class="mb-2">
                            <label class="form-label">Quiz Question*</label>
                            <input type="text" name="question" class="form-control" required>
                          </div>
                          <div class="row">
                            <div class="col-md-6">
                              <label class="form-label">Option A*</label>
                              <input type="text" name="optionA" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                              <label class="form-label">Option B*</label>
                              <input type="text" name="optionB" class="form-control" required>
                            </div>
                          </div>
                          <div class="row mt-2">
                            <div class="col-md-6">
                              <label class="form-label">Option C*</label>
                              <input type="text" name="optionC" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                              <label class="form-label">Option D*</label>
                              <input type="text" name="optionD" class="form-control" required>
                            </div>
                          </div>
                          <div class="mt-2">
                            <label class="form-label">Correct Answer*</label>
                            <select class="form-select" name="correctAnswer" required>
                              <option value="">Select correct answer</option>
                              <option value="A">A</option>
                              <option value="B">B</option>
                              <option value="C">C</option>
                              <option value="D">D</option>
                            </select>
                          </div>
                        </div>
                        <div class="mt-3">
                          <button type="submit" class="btn btn-success btn-sm">Save Quiz</button>
                          <button type="button" class="btn btn-secondary btn-sm" onclick="hideQuizForm(this)">Cancel</button>
                        </div>
                      </form>
                    </div>
                  </div>

                  <!-- Add Lesson Form -->
                  <form th:action="@{/instructordashboard/viewcourse/lessonadd}" th:object="${lessonVideoDTO}" method="post"
                        class="lesson-form mt-3" style="display:none;"
                        th:attr="data-chapterid=${chapter.id}">
                    <input type="hidden" name="chapterId" th:value="${chapter.id}">
                    <div class="lesson-form-header mb-3">
                      <h6>Add New Lesson</h6>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <label class="form-label">Lesson Title*</label>
                        <input type="text" th:field="*{title}" class="form-control" required>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Lesson Description*</label>
                        <textarea class="form-control" th:field="*{description}" rows="2"></textarea>
                      </div>
                    </div>
                    <div class="row mt-2">
                      <div class="col-md-6">
                        <label class="form-label">Video URL (Optional)</label>
                        <input type="text" th:field="*{videoUrl}" class="form-control" placeholder="YouTube video URL">
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Duration</label>
                        <input type="text" th:field="*{duration}" class="form-control" placeholder="e.g., 10:30">
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Access Type*</label>
                        <select class="form-select" th:field="*{isFree}">
                          <option value="true">Free</option>
                          <option value="false">Premium</option>
                        </select>
                      </div>
                    </div>
                    <div class="mt-3">
                      <button type="submit" class="btn btn-success btn-sm">Save Lesson</button>
                      <button type="button" class="btn btn-secondary btn-sm" onclick="hideLessonForm(this)">Cancel</button>
                    </div>
                  </form>

                  <!-- Empty State for Lessons -->
                  <div th:if="${chapter.lessons == null or #lists.isEmpty(chapter.lessons)}" class="empty-lessons text-center py-3">
                    <i class="bi bi-collection text-muted" style="font-size: 2rem;"></i>
                    <p class="text-muted mt-2">No lessons added yet. Click "Add Lesson" to get started.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Empty State for Chapters -->
          <div th:if="${#lists.isEmpty(chapters)}" class="empty-chapters text-center py-5">
            <i class="bi bi-book text-muted" style="font-size: 3rem;"></i>
            <h5 class="text-muted mt-3">No chapters created yet</h5>
            <p class="text-muted">Start building your course by adding your first chapter above.</p>
          </div>
        </div>
      </div>

      <!-- Video Modal -->
      <div class="modal fade" id="videoModal" tabindex="-1" aria-labelledby="videoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="videoModalLabel">Lesson Video</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                      onclick="stopVideo()"></button>
            </div>
            <div class="modal-body d-flex justify-content-center">
              <div style="width: 100%; max-width: 800px; aspect-ratio: 16/9;">
                <iframe id="lessonVideoIframe"
                        style="width: 100%; height: 100%; border-radius: 12px;"
                        frameborder="0"
                        allowfullscreen></iframe>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div id="chaptersContainer">
        <div class="content-card">
          <div class="d-flex justify-content-between">
            <form th:action="@{/instructordashboard/viewcourse/addcoursestep1}" method="GET">
              <input type="hidden" name="courseId" th:value="${courseId}"/>
              <button class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-1"></i> Previous
              </button>
            </form>
            <div>
              <form th:action="@{/instructordashboard/viewcourse/addcoursestep3}" method="POST" class="d-inline">
                <button class="btn btn-outline-secondary me-2" name="action" value="draft" id="saveDraftBtn">
                  <i class="bi bi-save me-1"></i> Save as Draft
                </button>
                <input type="hidden" name="courseId" th:value="${courseId}"/>
                <button class="btn btn-primary" name="action" value="nextstep">
                  Next <i class="bi bi-arrow-right ms-1"></i>
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    :root {
      --primary-color: #2563eb;
      --success-color: #059669;
      --warning-color: #d97706;
      --danger-color: #dc2626;
    }

    body {
      min-height: 100vh;
      background-color: #f8f9fa;
    }

    .content-card {
      background-color: #fff;
      border-radius: 0.5rem;
      box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .step-indicator {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
    }

    .step {
      flex: 1;
      text-align: center;
      position: relative;
    }

    .step:not(:last-child)::after {
      content: '';
      position: absolute;
      top: 15px;
      right: -50%;
      width: 100%;
      height: 2px;
      background-color: #dee2e6;
      z-index: 1;
    }

    .step.active:not(:last-child)::after,
    .step.completed:not(:last-child)::after {
      background-color: var(--primary-color);
    }

    .step-circle {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #dee2e6;
      color: #6c757d;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-bottom: 0.5rem;
      position: relative;
      z-index: 2;
    }

    .step.active .step-circle {
      background-color: var(--primary-color);
      color: white;
    }

    .step.completed .step-circle {
      background-color: var(--success-color);
      color: white;
    }

    .form-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .form-title {
      font-weight: bold;
      color: #1f2937;
      margin-bottom: 30px;
    }

    .btn-custom {
      background-color: var(--primary-color);
      color: white;
      border: none;
    }

    .btn-custom:hover {
      background-color: #1d4ed8;
      color: white;
    }

    .chapter-form-section {
      background-color: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid var(--primary-color);
    }

    .chapter-card {
      border: 1px solid #dee2e6;
      border-radius: 8px;
      margin-bottom: 1.5rem;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .chapter-header {
      padding: 1.5rem;
      background-color: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      border-radius: 8px 8px 0 0;
    }

    .chapter-body {
      padding: 1.5rem;
    }

    .lesson-item {
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 1rem;
      background-color: #fafafa;
      transition: all 0.2s;
    }

    .lesson-item:hover {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      border-color: #d1d5db;
    }

    .lesson-header h6 {
      color: #374151;
      font-weight: 600;
    }

    .video-section {
      background-color: #eff6ff;
      padding: 12px;
      border-radius: 6px;
      border-left: 3px solid var(--primary-color);
    }

    .add-video-section {
      background-color: #f0fdf4;
      padding: 12px;
      border-radius: 6px;
      border-left: 3px solid var(--success-color);
    }

    .quiz-item {
      background-color: #fffbeb;
      padding: 8px 12px;
      border-radius: 4px;
      border-left: 3px solid var(--warning-color);
    }

    .lesson-video-link {
      color: var(--primary-color);
      text-decoration: none;
    }

    .lesson-video-link:hover {
      color: #1d4ed8;
      text-decoration: underline;
    }

    .lesson-form, .video-form, .quiz-form {
      background-color: #f9fafb;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      margin-top: 15px;
    }

    .lesson-form-header h6 {
      color: #374151;
      font-weight: 600;
      margin-bottom: 0;
    }

    .empty-lessons, .empty-chapters {
      color: #6b7280;
    }

    .chapter-actions .btn, .lesson-actions .btn {
      border-radius: 4px;
    }

    .badge {
      font-size: 0.75rem;
    }

    @media (max-width: 768px) {
      .form-container {
        padding: 20px;
        margin: 20px;
      }

      .chapter-header .d-flex {
        flex-direction: column;
        gap: 15px;
      }

      .lesson-header .d-flex {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Video modal functionality
      document.querySelectorAll('.lesson-video-link').forEach(function(link) {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          var videoId = this.getAttribute('data-videoid');
          var iframe = document.getElementById('lessonVideoIframe');
          iframe.src = "https://www.youtube.com/embed/" + videoId;
          var modal = new bootstrap.Modal(document.getElementById('videoModal'));
          modal.show();
        });
      });
    });

    function stopVideo() {
      document.getElementById('lessonVideoIframe').src = "";
    }

    // Show lesson form
    function showLessonForm(btn) {
      hideAllForms();
      var chapterId = btn.getAttribute('data-chapterid');
      var form = document.querySelector('.lesson-form[data-chapterid="' + chapterId + '"]');
      if (form) {
        form.style.display = 'block';
        form.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    }

    // Hide lesson form
    function hideLessonForm(btn) {
      btn.closest('.lesson-form').style.display = 'none';
    }

    // Show video form
    function showVideoForm(btn) {
      hideAllForms();
      var lessonId = btn.getAttribute('data-lessonid');
      var form = document.querySelector('.video-form[data-lessonid="' + lessonId + '"]');
      if (form) {
        form.style.display = 'block';
        form.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    }

    // Hide video form
    function hideVideoForm(btn) {
      btn.closest('.video-form').style.display = 'none';
    }

    // Show quiz form
    function showQuizForm(btn) {
      hideAllForms();
      var lessonId = btn.getAttribute('data-lessonid');
      var form = document.querySelector('.quiz-form[data-lessonid="' + lessonId + '"]');
      if (form) {
        form.style.display = 'block';
        form.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    }

    // Hide quiz form
    function hideQuizForm(btn) {
      btn.closest('.quiz-form').style.display = 'none';
    }

    // Hide all forms
    function hideAllForms() {
      document.querySelectorAll('.lesson-form, .video-form, .quiz-form').forEach(function(form) {
        form.style.display = 'none';
      });
    }

    // Close forms when clicking outside
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.lesson-form, .video-form, .quiz-form') &&
              !e.target.closest('button[onclick*="show"]')) {
        // Uncomment the line below if you want forms to close when clicking outside
        // hideAllForms();
      }
    });
  </script>
</div>
</body>
</html>